<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Registro de Ventas</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    input, button { padding: 5px; margin: 5px; }
    table { border-collapse: collapse; margin-top: 20px; width: 100%; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
    th { background-color: #f2f2f2; }
    #message { margin: 10px 0; padding: 5px; }
  </style>
</head>
<body>
  <h1>Registro de Ventas</h1>

  <form id="salesForm">
    <input type="number" id="id" placeholder="ID" required>
    <input type="text" id="product" placeholder="Producto" required>
    <input type="number" id="amount" placeholder="Monto" required>
    <button type="submit">Registrar venta</button>
  </form>

  <div id="message"></div>

  <h2>Ventas Registradas</h2>
  <table id="salesTable">
    <thead>
      <tr>
        <th>ID</th>
        <th>Producto</th>
        <th>Monto</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <script>
    const form = document.getElementById("salesForm");
    const tableBody = document.querySelector("#salesTable tbody");
    const messageDiv = document.getElementById("message");
    const apiUrl = "https://little-feather-4d5fsales-platform-api.yojhan-ttito-p.workers.dev/sales";

    async function loadSales() {
      try {
        const res = await fetch(apiUrl);
        const json = await res.json();
        tableBody.innerHTML = "";
        json.data.forEach(sale => {
          const row = document.createElement("tr");
          row.innerHTML = `<td>${sale.id}</td><td>${sale.product}</td><td>${sale.amount}</td>`;
          tableBody.appendChild(row);
        });
      } catch (err) {
        messageDiv.textContent = "Error al cargar ventas.";
        messageDiv.style.color = "red";
      }
    }

    form.addEventListener("submit", async (e) => {
      e.preventDefault();
      messageDiv.textContent = "";

      const data = {
        id: document.getElementById("id").value,
        product: document.getElementById("product").value,
        amount: parseFloat(document.getElementById("amount").value)
      };

      if (!data.id || !data.product || isNaN(data.amount) || data.amount <= 0) {
        messageDiv.textContent = "Por favor, ingresa todos los campos correctamente.";
        messageDiv.style.color = "red";
        return;
      }

      try {
        const res = await fetch(apiUrl, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(data)
        });
        const json = await res.json();

        if (res.ok) {
          messageDiv.textContent = "Venta registrada correctamente!";
          messageDiv.style.color = "green";
          form.reset();
          loadSales();
        } else {
          messageDiv.textContent = json.message || "Error al registrar venta.";
          messageDiv.style.color = "red";
        }
      } catch (err) {
        messageDiv.textContent = "Error al registrar venta.";
        messageDiv.style.color = "red";
      }
    });

    // Refrescar ventas cada 10 segundos
    loadSales();
    setInterval(loadSales, 10000);
  </script>
</body>
</html>
